# トレジャリーマネジメントツール

Streamlitベースの企業向けトレジャリーマネジメントツールです。CSVデータの取り込み、可視化、分析、およびAIチャット機能を提供します。

## 機能

### 1. データ管理
- CSVファイルのアップロード機能
- 口座残高、取引履歴、予算、為替レートデータの管理
- 国情報を含むデータの処理と標準化
- サンプルデータでのテスト機能

### 2. ダッシュボード
- 総残高、口座数、対象国数の表示
- 口座別残高の円グラフ
- 世界地図での国別残高分布
- 日次・累積キャッシュフロー推移
- 取引タイプ別分析

### 3. データビューア
- アップロードされたデータの表形式表示
- データの基本統計情報（行数、列数、期間）
- データのダウンロード、検索、フルスクリーン表示

### 4. 基本分析
- 口座残高の基本統計（総残高、平均残高、最大残高国など）
- 取引履歴の基本統計（総取引件数、総取引金額、最頻取引タイプなど）

### 5. AIチャット（オプション）
- OpenAI GPT-4を使用した自然言語での質問応答
- LangChainエージェントによるデータ分析
- PandasとPython REPLツールの統合

## 技術スタック

- **フロントエンド**: Streamlit
- **データ処理**: Pandas, NumPy
- **可視化**: Plotly Express, Plotly Graph Objects
- **地理データ**: pycountry
- **AI機能**: LangChain, OpenAI GPT-4
- **テスト**: unittest

## インストールと実行

### 必要な依存関係のインストール

```bash
pip install streamlit pandas plotly pycountry langchain langchain-openai langchain-experimental
```

### アプリケーションの実行

```bash
streamlit run app.py
```

### テストの実行

```bash
python test_app.py
```

### サンプルデータの生成

```bash
python create_sample_data.py
```

## ファイル構成

```
treasury_management_tool/
├── app.py                    # メインアプリケーション
├── data_utils.py            # データ処理とビジュアライゼーション
├── agent_utils.py           # LangChainエージェント統合
├── create_sample_data.py    # サンプルデータ生成
├── test_app.py             # テストスイート
├── sample_balances.csv     # サンプル口座残高データ
├── sample_transactions.csv # サンプル取引履歴データ
├── sample_budgets.csv      # サンプル予算データ
├── sample_fx_rates.csv     # サンプル為替レートデータ
└── README.md               # このファイル
```

## 使用方法

### 1. データの準備

以下のフォーマットでCSVファイルを準備してください：

#### 口座残高データ
```csv
日付,口座ID,銀行名,通貨,残高,国名,国コード
2024-01-01,ACC001,三菱UFJ銀行,JPY,1000000,日本,JPN
```

#### 取引履歴データ
```csv
日付,口座ID,取引ID,取引タイプ,金額,摘要,相手国名,相手国コード
2024-01-01,ACC001,TXN001,入金,100000,給与,日本,JPN
```

#### 予算データ
```csv
日付,部門,カテゴリ,予算額
2024-01-01,営業部,人件費,5000000
```

#### 為替レートデータ
```csv
日付,通貨ペア,レート
2024-01-01,USD/JPY,150.0
```

### 2. アプリケーションの起動

1. `streamlit run app.py` でアプリケーションを起動
2. ブラウザで表示されるURLにアクセス
3. サイドバーでデータをアップロードまたはサンプルデータを使用
4. 各タブで機能を確認

### 3. AIチャット機能の使用

1. サイドバーでOpenAI APIキーを入力
2. AIチャットタブで自然言語で質問
3. 例：「各国の口座残高を教えて」「最も取引量の多い月は？」

## 特徴

### セキュリティ
- APIキーは環境変数または設定ファイルでの管理を推奨
- 本番環境では`allow_dangerous_code=False`の使用を検討

### 拡張性
- 新しいデータタイプの追加が容易
- カスタム分析機能の追加が可能
- 追加のビジュアライゼーションの実装が簡単

### パフォーマンス
- 大規模データセットに対してはDaskやParquetの使用を検討
- キャッシュ機能の活用でレスポンス向上

## 制限事項

- 現在はCSVファイルのみサポート
- リアルタイムデータ更新は未対応
- データベース連携は未実装
- 複雑な財務計算は基本的なもののみ

## 今後の拡張予定

- データベース連携
- リアルタイムデータ更新
- より高度な財務分析機能
- ユーザー認証とアクセス制御
- レポート生成機能
- API連携機能


